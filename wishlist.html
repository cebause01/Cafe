<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/cofee_6956496.png">
    <meta name="description" content="Your BforBrew wishlist - Save your favorite coffee beans for later.">
    <title>Wishlist | BforBrew</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;"><h1>BforBrew</h1></a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html#home">Home</a></li>
                <li><a href="shop.html">Coffee Beans</a></li>
                <li><a href="menu.html">Menu</a></li>
                <li class="nav-dropdown">
                    <a href="#" class="dropdown-toggle">More <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;"><polyline points="6 9 12 15 18 9"></polyline></svg></a>
                    <ul class="dropdown-menu">
                        <li><a href="index.html#cafe">Cafe Experience</a></li>
                        <li><a href="index.html#contact">Visit Us</a></li>
                        <li><a href="reservation.html">Reservation</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="gallery.html">Gallery</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                    </ul>
                </li>
            </ul>
            <div class="nav-actions">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="searchInput" class="search-input" placeholder="Search...">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                </div>
                <button class="search-icon-btn" id="searchIconBtn" aria-label="Search" onclick="openSearchModal()">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
                <a href="wishlist.html" class="nav-icon-link" aria-label="Wishlist">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span class="wishlist-count" id="wishlistCount">0</span>
                </a>
                <a href="cart.html" class="nav-icon-link" aria-label="Shopping Cart">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span class="cart-count">0</span>
                </a>
                <div id="authContainer" class="auth-container"></div>
            </div>
            <button class="mobile-menu-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Search Modal -->
    <div id="searchModal" class="search-modal">
        <div class="search-modal-content">
            <button id="closeSearch" class="close-search">Ã—</button>
            <div class="search-modal-input-wrapper">
                <input type="text" id="searchModalInput" class="search-modal-input" placeholder="Search...">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>
    </div>

    <!-- Wishlist Header -->
    <section class="reservation-header">
        <div class="container">
            <h1>My Wishlist</h1>
            <p>Your saved favorite coffee beans</p>
        </div>
    </section>

    <!-- Wishlist Content -->
    <section class="wishlist-section">
        <div class="container">
            <div id="wishlistContainer" class="beans-grid">
                <!-- Wishlist items will be dynamically loaded here -->
            </div>
            <div id="emptyWishlist" style="display: none; text-align: center; padding: 4rem 2rem;">
                <h2>Your wishlist is empty</h2>
                <p style="color: var(--text-light); margin: 1rem 0 2rem;">Start adding your favorite coffee beans to your wishlist!</p>
                <a href="shop.html" class="btn btn-primary">Browse Coffee Beans</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>BforBrew</h3>
                    <p>Premium coffee, community, and connection in the heart of Melaka.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="shop.html">Coffee Beans</a></li>
                        <li><a href="menu.html">Menu</a></li>
                        <li><a href="wishlist.html">Wishlist</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Shop</h4>
                    <ul>
                        <li><a href="shop.html">Browse Beans</a></li>
                        <li><a href="shop.html">Order Online</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="index.html#contact">Visit Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="blog.html">Blog</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 BforBrew. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        function getAllCoffeeBeansForWishlist() {
            // Try to use coffeeBeans from shop.js if available
            if (typeof coffeeBeans !== 'undefined' && Array.isArray(coffeeBeans) && coffeeBeans.length > 0) {
                return coffeeBeans;
            }
            // Use getAllCoffeeBeans from cart.js if available (use window version)
            if (typeof window.getAllCoffeeBeans === 'function') {
                return window.getAllCoffeeBeans();
            }
            // Fallback: minimal dataset
            return [
                { id: 1, name: "Humble Mornings Blend", price: 65.00, description: "A smooth, balanced medium roast", details: ["12 oz bag", "17-21 servings", "Medium Roast"], badge: "Best Seller", gradient: "linear-gradient(135deg, #6F4E37 0%, #8B6F47 100%)", image: null },
                { id: 2, name: "BforBrew Signature Dark Roast", price: 65.00, description: "Bold and intense with smoky notes", details: ["12 oz bag", "17-21 servings", "Dark Roast"], badge: "New", gradient: "linear-gradient(135deg, #3E2723 0%, #5D4037 100%)" },
                { id: 3, name: "Melaka Light Roast", price: 65.00, description: "Bright and fruity with floral notes", details: ["12 oz bag", "17-21 servings", "Light Roast"], badge: "Light", gradient: "linear-gradient(135deg, #8D6E63 0%, #A1887F 100%)" }
            ];
        }

        async function renderWishlist() {
            // Use getWishlist from wishlist.js if available (for logged-in users)
            let wishlist = [];
            if (typeof window.getWishlist === 'function') {
                wishlist = await window.getWishlist();
                console.log('Wishlist from API:', wishlist);
            } else {
                wishlist = JSON.parse(localStorage.getItem('bforbrew_wishlist') || '[]');
                console.log('Wishlist from localStorage:', wishlist);
            }
            
            const wishlistContainer = document.getElementById('wishlistContainer');
            const emptyWishlist = document.getElementById('emptyWishlist');

            if (!wishlist || wishlist.length === 0) {
                wishlistContainer.style.display = 'none';
                emptyWishlist.style.display = 'block';
                return;
            }

            wishlistContainer.style.display = 'grid';
            emptyWishlist.style.display = 'none';

            const allCoffeeBeans = getAllCoffeeBeansForWishlist();
            const wishlistItems = allCoffeeBeans.filter(bean => wishlist.includes(bean.id));

            wishlistContainer.innerHTML = wishlistItems.map(bean => `
                <div class="bean-card" onclick="openBeanModal(${bean.id})" style="cursor: pointer;">
                    <div class="bean-image" style="background: ${bean.image ? 'none' : bean.gradient};">
                        ${bean.image ? `<img src="${bean.image}" alt="${bean.name}" class="bean-product-image">` : ''}
                    </div>
                    <div class="bean-info">
                        ${bean.badge ? `<span class="bean-badge">${bean.badge}</span>` : ''}
                        <h3>${bean.name}</h3>
                        <p class="bean-description">${bean.description}</p>
                        <div class="bean-details">
                            ${bean.details.map(detail => `<span class="detail-item">${detail}</span>`).join('')}
                        </div>
                        <div class="bean-price">
                            <span class="price">RM ${bean.price.toFixed(2)}</span>
                            <button class="btn btn-add-to-cart" data-id="${bean.id}" onclick="event.stopPropagation(); addToCartFromWishlist(${bean.id})">Add to Cart</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function addToCartFromWishlist(productId) {
            // Use window.addToCart from cart.js
            if (typeof window.addToCart === 'function') {
                const success = await window.addToCart(productId);
                if (success) {
                    if (typeof showNotification === 'function') {
                        showNotification('Added to cart!', 'success');
                    } else {
                        alert('Added to cart!');
                    }
                }
            } else {
                console.error('addToCart function not found. Make sure cart.js is loaded.');
                alert('Error: Unable to add to cart. Please try again.');
            }
        }
        // Make it globally available
        window.addToCartFromWishlist = addToCartFromWishlist;

        document.addEventListener('DOMContentLoaded', async () => {
            await renderWishlist();
            // Update auth UI if available
            if (typeof updateAuthUI === 'function') {
                updateAuthUI();
            }
        });
    </script>
    
    <!-- Auth Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content" id="authModalContent">
            <!-- Modal content will be dynamically loaded here -->
        </div>
    </div>
    
    <script src="js/auth.js"></script>
    <script src="js/shop.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/wishlist.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/search.js"></script>
    <script src="js/script.js"></script>
</body>
</html>

